From a4bc14a4164c68a09f941f9266c7274bf5810485 Mon Sep 17 00:00:00 2001
From: rorgoroth <77244135+rorgoroth@users.noreply.github.com>
Date: Mon, 18 Dec 2023 13:23:33 +0000
Subject: [PATCH 2/2] Revert "gdigrab: allow capturing a window by its handle"

This reverts commit d67e052c4155d65054aa16075d67704d5894202b.
---
 Changelog             |  1 -
 doc/indevs.texi       |  8 ++------
 libavdevice/gdigrab.c | 15 +--------------
 3 files changed, 3 insertions(+), 21 deletions(-)

diff --git a/Changelog b/Changelog
index 8de7eb4..353c4b7 100644
--- a/Changelog
+++ b/Changelog
@@ -14,7 +14,6 @@ version <next>:
 - demuxing, decoding, filtering, encoding, and muxing in the
   ffmpeg CLI now all run in parallel
 - atonesrc filter
-- enable gdigrab device to grab a window using the hwnd=HANDLER syntax
 
 version 6.1:
 - libaribcaption decoder
diff --git a/doc/indevs.texi b/doc/indevs.texi
index a0c684f..863536a 100644
--- a/doc/indevs.texi
+++ b/doc/indevs.texi
@@ -722,7 +722,7 @@ Win32 GDI-based screen capture device.
 
 This device allows you to capture a region of the display on Windows.
 
-Amongst options for the imput filenames are such elements as:
+There are two options for the input filename:
 @example
 desktop
 @end example
@@ -730,13 +730,9 @@ or
 @example
 title=@var{window_title}
 @end example
-or
-@example
-hwnd=@var{window_hwnd}
-@end example
 
 The first option will capture the entire desktop, or a fixed region of the
-desktop. The second and third options will instead capture the contents of a single
+desktop. The second option will instead capture the contents of a single
 window, regardless of its position on the screen.
 
 For example, to grab the entire desktop using @command{ffmpeg}:
diff --git a/libavdevice/gdigrab.c b/libavdevice/gdigrab.c
index 41ef370..c069232 100644
--- a/libavdevice/gdigrab.c
+++ b/libavdevice/gdigrab.c
@@ -273,22 +273,9 @@ gdigrab_read_header(AVFormatContext *s1)
         }
     } else if (!strcmp(filename, "desktop")) {
         hwnd = NULL;
-    } else if (!strncmp(filename, "hwnd=", 5)) {
-        name = filename + 5;
-        char *p;
-
-        hwnd = strtol(name, &p, 0);
-
-        if (p == NULL || p == name || p[0] == '\0')
-        {
-            av_log(s1, AV_LOG_ERROR,
-                   "Invalid window handle '%s', must be a valid integer.\n", name);
-            ret = AVERROR(EINVAL);
-            goto error;
-        }
     } else {
         av_log(s1, AV_LOG_ERROR,
-               "Please use \"desktop\", \"title=<windowname>\" or \"hwnd=<hwnd>\" to specify your target.\n");
+               "Please use \"desktop\" or \"title=<windowname>\" to specify your target.\n");
         ret = AVERROR(EIO);
         goto error;
     }
-- 
2.43.0

